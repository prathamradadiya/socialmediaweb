<!-- <!DOCTYPE html>
<html>
<body>

<h2>Enable Push</h2>
<button onclick="init()">Enable Notifications</button>

<p id="tokenBox"></p>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-messaging-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyAW45Nx4ljmnqvr509jl3tK0SSje8wizrs",
  authDomain: "instagram-58230.firebaseapp.com",
  projectId: "instagram-58230",
  storageBucket: "instagram-58230.firebasestorage.app",
  messagingSenderId: "470839495593",
  appId: "1:470839495593:web:bc1da0448bf19c1c7152b8",
  measurementId: "G-XRJC1195VY"
});

const messaging = firebase.messaging();

async function init() {
const permission = await Notification.requestPermission();
if (permission !== "granted") return alert("Permission denied");


  const token = await messaging.getToken({
   vapidKey: "BDOxR4-uiNU0UfiSVp37sGUXMvRuY5zFur_Avy4JrymUp1PcbYcbVNwGPaHtPVMHTHhOpdTjymvbdYKwy1lAsV4"

  });

  document.getElementById("tokenBox").innerText = token;

  // send token to backend
  await fetch("/api/auth/device-token", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ deviceToken: token })

  });
}

messaging.onMessage((payload) => {
  alert(payload.notification.title + " - " + payload.notification.body);
});
</script>

</body>
</html> -->
<!DOCTYPE html>
<html>
<body>

<h2>Enable Push</h2>
<button onclick="init()">Enable Notifications</button>

<p id="tokenBox"></p>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-messaging-compat.js"></script>

<script>
/* ================= FIREBASE INIT ================= */
firebase.initializeApp({
  apiKey: "AIzaSyAW45Nx4ljmnqvr509jl3tK0SSje8wizrs",
  authDomain: "instagram-58230.firebaseapp.com",
  projectId: "instagram-58230",
  storageBucket: "instagram-58230.appspot.com",
  messagingSenderId: "470839495593",
  appId: "1:470839495593:web:bc1da0448bf19c1c7152b8"
});

/* âœ… GLOBAL VARIABLE */
const messaging = firebase.messaging();

/* ================= INIT FUNCTION ================= */
async function init() {
  const permission = await Notification.requestPermission();
  if (permission !== "granted") {
    alert("Permission denied");
    return;
  }

  const fcmToken = await messaging.getToken({
    vapidKey: "BDOxR4-uiNU0UfiSVp37sGUXMvRuY5zFur_Avy4JrymUp1PcbYcbVNwGPaHtPVMHTHhOpdTjymvbdYKwy1lAsV4"
  });

  document.getElementById("tokenBox").innerText = fcmToken;
  console.log(fcmToken);
  const accessToken = localStorage.getItem("accessToken");
  if (!accessToken) {
    alert("Please login first");
    return;
  }

  const res = await fetch("http://localhost:3001/api/auth/device-token", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: `Bearer ${accessToken}`,
    },
    body: JSON.stringify({ deviceToken: fcmToken }),
  });

  const data = await res.json();
  console.log("Backend response:", data);
}

/* ================= FOREGROUND MESSAGE ================= */
messaging.onMessage((payload) => {
  alert(payload.notification.title + " - " + payload.notification.body);
});
</script>

</body>
</html>
